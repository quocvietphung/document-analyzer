<!-- src/app/pages/document-management/document-management.html -->
<mat-sidenav-container class="dm-shell">

  <!-- Ná»™i dung chÃ­nh -->
  <mat-sidenav-content>

    <main class="document-management-content">
      <h2 class="document-management-title">Welcome to Document Management ðŸ“‚</h2>
      <p class="document-management-subtitle">
        Manage your documents <b>securely</b> and efficiently
      </p>

      <!-- 1 input duy nháº¥t dÃ¹ng chung -->
      <input #uploader type="file" hidden (change)="onFileSelected($event)" />

      <!-- Document List -->
      <div class="document-list" *ngIf="documents.length > 0; else emptyState">
        <div class="section-head">
          <h3>Your Documents</h3>
          <button mat-stroked-button color="primary" (click)="uploader.click()">
            <mat-icon>cloud_upload</mat-icon>
            Upload
          </button>
        </div>

        <mat-list>
          <mat-list-item *ngFor="let doc of documents" class="doc-item">
            <div class="doc-click" (click)="viewDocument(doc)">
              <mat-icon color="primary" class="file-icon">description</mat-icon>
              <div class="meta">
                <span class="doc-info" [title]="doc.fileName">{{ doc.fileName }}</span>
                <small class="doc-type">{{ doc.documentType || 'GENERAL' }}</small>
              </div>
            </div>

            <button
              mat-icon-button
              color="warn"
              (click)="$event.stopPropagation(); deleteDocument(doc.id)"
              aria-label="Delete document"
            >
              <mat-icon>delete</mat-icon>
            </button>
          </mat-list-item>
        </mat-list>
      </div>

      <!-- Empty state -->
      <ng-template #emptyState>
        <div class="empty-card">
          <mat-icon>folder_open</mat-icon>
          <h4>No documents yet</h4>
          <p>Upload your first file to get started.</p>
          <button mat-raised-button color="primary" (click)="uploader.click()">
            <mat-icon>upload</mat-icon>
            Upload now
          </button>
        </div>
      </ng-template>
    </main>

  </mat-sidenav-content>

  <!-- Viewer kiá»ƒu LinkedIn: slide-in tá»« pháº£i -->
  <mat-sidenav
    class="dm-viewer"
    position="end"
    mode="over"
    [opened]="viewerOpen"
    (closedStart)="onViewerClosed()"
  >
    <mat-toolbar class="viewer-toolbar" color="primary">
      <span class="viewer-title" [title]="viewerName">{{ viewerName || 'Document' }}</span>
      <span class="spacer"></span>
      <button mat-icon-button (click)="openInNewTab()" matTooltip="Open in new tab">
        <mat-icon>open_in_new</mat-icon>
      </button>
      <button mat-icon-button (click)="downloadCurrent()" matTooltip="Download">
        <mat-icon>download</mat-icon>
      </button>
      <button mat-icon-button (click)="closeViewer()" matTooltip="Close">
        <mat-icon>close</mat-icon>
      </button>
    </mat-toolbar>

    <div class="viewer-body">
      <div class="viewer-loading" *ngIf="loadingViewer">
        <mat-progress-spinner mode="indeterminate" diameter="40"></mat-progress-spinner>
        <div>Loading PDFâ€¦</div>
      </div>

      <ng-container *ngIf="!loadingViewer">
        <!-- Æ¯u tiÃªn object (há»— trá»£ tá»‘t height/zoom), fallback link -->
        <object
          *ngIf="viewerUrl; else viewerFallback"
          [data]="viewerUrl"
          type="application/pdf"
          class="pdf-object"
        >
        </object>

        <ng-template #viewerFallback>
          <div class="viewer-fallback">
            <p>Your browser canâ€™t display this PDF.</p>
            <button mat-stroked-button color="primary" (click)="openInNewTab()">
              <mat-icon>open_in_new</mat-icon>
              Open in new tab
            </button>
          </div>
        </ng-template>
      </ng-container>
    </div>
  </mat-sidenav>

</mat-sidenav-container>
